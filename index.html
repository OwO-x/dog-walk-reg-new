<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dog Walk Status</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
  <!-- Load profanity filter library -->
  <script src="https://cdn.jsdelivr.net/npm/bad-words@3.0.0/dist/bad-words.min.js"></script>
  <style>
    /* [Previous CSS remains exactly the same] */
    /* Error message styling */
    .error-message {
      color: #d32f2f;
      font-size: 0.9rem;
      margin-top: 5px;
      display: none;
      animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }

    @keyframes shake {
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-4px); }
      40%, 60% { transform: translateX(4px); }
    }

    .input-error {
      border-color: #d32f2f !important;
      animation: pulseError 0.5s ease;
    }

    @keyframes pulseError {
      0% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(211, 47, 47, 0); }
      100% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0); }
    }
  </style>
</head>
<body>
  <!-- [Previous HTML remains exactly the same until the script section] -->

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCTLsji9XOlgHK-YUPrQYSfLPB5NoerVWY",
      authDomain: "dog-walk-reg.firebaseapp.com",
      databaseURL: "https://dog-walk-reg-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "dog-walk-reg",
      storageBucket: "dog-walk-reg.firebasestorage.app",
      messagingSenderId: "806193788108",
      appId: "1:806193788108:web:ac6df92dd5800bd74a3e69",
      measurementId: "G-9Y7PYSP8NP"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const statusListRef = ref(database, 'dogWalkStatuses');

    // Initialize profanity filter
    const filter = new BadWords();
    // Add custom words to filter (optional)
    filter.addWords('doggie', 'pooch'); // Example - add any words you want to block
    
    // Function to check for profanity
    function containsProfanity(text) {
      try {
        return filter.isProfane(text);
      } catch (e) {
        console.error("Profanity filter error:", e);
        return false;
      }
    }

    // Function to show error
    function showError(inputElement, message) {
      const errorElement = inputElement.nextElementSibling;
      if (errorElement && errorElement.classList.contains('error-message')) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        inputElement.classList.add('input-error');
        
        // Remove error after animation
        setTimeout(() => {
          inputElement.classList.remove('input-error');
        }, 1000);
      } else {
        // Create error element if it doesn't exist
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.textContent = message;
        inputElement.parentNode.insertBefore(errorDiv, inputElement.nextSibling);
        inputElement.classList.add('input-error');
        
        // Remove error after animation
        setTimeout(() => {
          inputElement.classList.remove('input-error');
        }, 1000);
      }
    }

    // Function to hide error
    function hideError(inputElement) {
      const errorElement = inputElement.nextElementSibling;
      if (errorElement && errorElement.classList.contains('error-message')) {
        errorElement.style.display = 'none';
      }
    }

    // Add error message elements after form inputs
    document.querySelectorAll('#walkForm input, #walkForm textarea').forEach(input => {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      input.parentNode.insertBefore(errorDiv, input.nextSibling);
    });

    // Display live updates
    onChildAdded(statusListRef, (snapshot) => {
      const statusData = snapshot.val();
      
      // Check for profanity in existing data (client-side only)
      let safeLocation = statusData.location;
      let safeNotes = statusData.notes || '';
      
      if (containsProfanity(safeLocation)) {
        safeLocation = "[Content moderated]";
      }
      
      if (containsProfanity(safeNotes)) {
        safeNotes = "[Content moderated]";
      }
      
      const statusDiv = document.createElement('div');
      statusDiv.className = 'status';
      
      let notesContent = '';
      if (safeNotes) {
        notesContent = `<p><strong>Notes:</strong> ${safeNotes}</p>`;
      }
      
      statusDiv.innerHTML = ` 
        <p><strong>Status:</strong> ${statusData.status}</p>
        <p><strong>Location:</strong> ${safeLocation}</p>
        <p><strong>Time:</strong> ${statusData.time}</p>
        <p><strong>Dog Status:</strong> ${statusData.dogStatus}</p>
        <p><strong>Safety Status:</strong> ${statusData.safety}</p>
        ${notesContent}
      `;
      
      // Add pulsing animation for new status
      statusDiv.style.animation = 'fadeIn 0.5s ease-out forwards';
      statusDiv.addEventListener('animationend', () => {
        statusDiv.style.animation = '';
      });
      
      // Prepend new statuses to the list so they appear at the top
      document.getElementById('statusList').insertBefore(statusDiv, document.getElementById('statusList').firstChild);
      
      // Show notification for new status (only if it's not the initial load)
      if (statusData.isNew) {
        showNotification('New dog walk status added!');
      }
    });

    // Form submission
    document.getElementById('walkForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitButton = e.target.querySelector('button[type="submit"]');
      submitButton.disabled = true;
      document.getElementById('loadingSpinner').style.display = 'block';
      
      // Get form values
      const walkingStatus = document.getElementById('walkingStatus').value;
      const location = document.getElementById('location').value;
      const walkTime = document.getElementById('walkTime').value;
      const dogStatus = document.getElementById('dogStatus').value;
      const safetyStatus = document.getElementById('safetyOptions').value;
      const otherNotes = document.getElementById('otherNotes').value;
      
      // Reset previous errors
      document.querySelectorAll('.error-message').forEach(el => {
        el.style.display = 'none';
      });
      document.querySelectorAll('.input-error').forEach(el => {
        el.classList.remove('input-error');
      });
      
      // Validate for profanity
      let hasProfanity = false;
      
      if (containsProfanity(location)) {
        showError(document.getElementById('location'), 'Please remove inappropriate language');
        hasProfanity = true;
      }
      
      if (containsProfanity(otherNotes)) {
        showError(document.getElementById('otherNotes'), 'Please remove inappropriate language');
        hasProfanity = true;
      }
      
      if (hasProfanity) {
        submitButton.disabled = false;
        document.getElementById('loadingSpinner').style.display = 'none';
        showNotification('Please remove inappropriate language before submitting');
        return;
      }
      
      // Add slight delay to show loading state
      await new Promise(resolve => setTimeout(resolve, 500));
      
      const statusData = {
        status: walkingStatus === 'yes' ? 'Walking' : 'Not Walking',
        location,
        time: walkTime,
        dogStatus,
        safety: safetyStatus,
        isNew: true // Flag to identify new submissions
      };

      // Add notes only if they exist
      if (otherNotes.trim() !== '') {
        statusData.notes = otherNotes;
      }

      try {
        // Add new status to Firebase
        await push(statusListRef, statusData);
        
        // Show success animation
        submitButton.style.animation = 'pulse 0.5s ease';
        submitButton.addEventListener('animationend', () => {
          submitButton.style.animation = '';
        });
        
        showNotification('Status submitted successfully!');
        
        // Reset form after submission
        document.getElementById('walkForm').reset();
      } catch (error) {
        showNotification('Error submitting status. Please try again.');
      } finally {
        submitButton.disabled = false;
        document.getElementById('loadingSpinner').style.display = 'none';
      }
    });

    // [Rest of the JavaScript remains the same]
  </script>
</body>
</html>
